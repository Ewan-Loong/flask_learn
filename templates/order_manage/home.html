<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <link rel="stylesheet" href="/static/css/base.css">
    <meta charset="UTF-8"/>
    <title>ç”µå•†è®¢å•ç®¡ç†ç³»ç»Ÿ</title>

    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f0f2f5;
            height: 100vh;
            overflow: hidden;
        }

        .container {
            display: flex;
            flex-direction: column;
            height: 100vh;
        }

        /* é¡¶éƒ¨å¯¼èˆªæ  */
        .header {
            background-color: #fff;
            padding: 0 20px;
            height: 60px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            z-index: 100;
        }

        .logo {
            font-size: 20px;
            font-weight: bold;
            color: #1890ff;
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background-color: #1890ff; /* é»˜è®¤å¤´åƒèƒŒæ™¯è‰² */
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            font-size: 18px;
        }

        .user-details {
            display: flex;
            flex-direction: column;
        }

        .username {
            font-weight: 600;
            color: #333;
        }

        .user-role {
            font-size: 12px;
            color: #888;
        }

        /* ä¸»ä½“å†…å®¹åŒºåŸŸ */
        .main-content {
            display: flex;
            flex: 1;
            overflow: hidden;
        }

        /* ä¾§è¾¹æ èœå• */
        .sidebar {
            width: 240px;
            background-color: #fff;
            padding: 20px 0;
            box-shadow: 2px 0 8px rgba(0, 0, 0, 0.1);
            overflow-y: auto;
        }

        .menu-item {
            padding: 12px 24px;
            cursor: pointer;
            transition: background-color 0.2s;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .menu-item:hover {
            background-color: #f5f5f5;
        }

        .menu-item.active {
            background-color: #e6f7ff;
            color: #1890ff;
            border-left: 3px solid #1890ff;
        }

        .menu-item i {
            width: 16px;
            text-align: center;
        }

        /* å†…å®¹åŒº */
        .content {
            height: calc(100vh - 64px);
            top: 64px;
            flex: 1;
            padding: 20px;
            overflow-y: auto;
            background-color: #fafafa;
        }

        .content h1 {
            margin-bottom: 20px;
            color: #333;
        }

        .content p {
            color: #666;
            line-height: 1.6;
        }

        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .dashboard-card {
            background-color: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            text-align: center;
        }

        .dashboard-card h3 {
            margin-bottom: 10px;
            color: #333;
        }

        .dashboard-card p {
            color: #888;
            font-size: 14px;
        }

        /* åŠ è½½çŠ¶æ€ */
        .loading {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100%;
            font-size: 18px;
            color: #888;
        }

        /* æ¶ˆæ¯æç¤º */
        .message {
            padding: 10px;
            border-radius: 4px;
            margin-bottom: 15px;
            text-align: center;
        }

        .message.error {
            background-color: #fff2f0;
            color: #ff4d4f;
            border: 1px solid #ffccc7;
        }

    </style>
</head>
<body data-api-base="/UserAuth">

<div class="container">
    <!-- é¡¶éƒ¨å¯¼èˆªæ  -->
    <header class="header">
        <div class="logo">ç”µå•†è®¢å•ç®¡ç†ç³»ç»Ÿ</div>
        <div class="user-info">
            <div class="avatar" id="userAvatar">U</div> <!-- é»˜è®¤å¤´åƒ -->
            <div class="user-details">
                <div class="username" id="usernameDisplay">åŠ è½½ä¸­...</div>
                <div class="user-role" id="userRoleDisplay">åŠ è½½ä¸­...</div>
            </div>
        </div>
    </header>

    <!-- ä¸»ä½“å†…å®¹ -->
    <div class="main-content">
        <!-- ä¾§è¾¹æ  -->
        <aside class="sidebar" id="sidebarMenu">
            <!-- èœå•é¡¹å°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
        </aside>

        <!-- å†…å®¹åŒº -->
        <main class="content" id="mainContent">
            <div id="contentArea" style="height: 100%">
                <h1>æ¬¢è¿ä½¿ç”¨åå°ç®¡ç†ç³»ç»Ÿ</h1>
                <p>è¯·é€‰æ‹©å·¦ä¾§èœå•é¡¹ä»¥æŸ¥çœ‹ç›¸åº”å†…å®¹ã€‚</p>
                <div class="dashboard-grid">
                    <div class="dashboard-card">
                        <h3>ç³»ç»Ÿæ¦‚è§ˆ</h3>
                        <p>æŸ¥çœ‹ç³»ç»Ÿæ•´ä½“è¿è¡ŒçŠ¶æ€</p>
                    </div>
                    <div class="dashboard-card">
                        <h3>ç”¨æˆ·ç®¡ç†</h3>
                        <p>ç®¡ç†å¹³å°ç”¨æˆ·ä¿¡æ¯</p>
                    </div>
                    <div class="dashboard-card">
                        <h3>æ•°æ®åˆ†æ</h3>
                        <p>æŸ¥çœ‹ä¸šåŠ¡æ•°æ®æŠ¥å‘Š</p>
                    </div>
                    <div class="dashboard-card">
                        <h3>ç³»ç»Ÿè®¾ç½®</h3>
                        <p>é…ç½®ç³»ç»Ÿå‚æ•°</p>
                    </div>
                </div>
            </div>
        </main>
    </div>
</div>
<script src="/static/js/api.js"></script>
<script src="/static/js/base.js"></script>
<script>
    // å£°æ˜å…¨å±€å˜é‡å­˜å‚¨ token å’Œç”¨æˆ·ä¿¡æ¯
    let globalToken = localStorage.getItem('Token')
    let currentUserInfo = null;

    // æ¨¡æ‹Ÿä»ç™»å½•ç•Œé¢ä¼ å…¥çš„ tokenï¼ˆå®é™…åº”ç”¨ä¸­åº”ä»ç™»å½•æˆåŠŸåè·å–ï¼‰
    // globalToken = 'your_token_here'; // ä¾‹å¦‚ï¼Œä»localStorageè·å–æˆ–ä½œä¸ºå‚æ•°ä¼ é€’

    // æ¨¡æ‹Ÿå½“å‰ç”¨æˆ·ä¿¡æ¯ï¼ˆå¦‚æœæ— æ³•ä»APIè·å–ï¼Œå¯ä»¥æ‰‹åŠ¨è®¾ç½®ç”¨äºæµ‹è¯•ï¼‰
    // const mockUserInfo = { name: 'Admin', role: 'ç®¡ç†å‘˜', email: 'admin@example.com' };

    // å®šä¹‰å½“å‰å¯è®¿é—®çš„åå°ç³»ç»Ÿèœå•é¡¹
    const availableSystems = [
        {id: 'dashboard', name: 'ä»ªè¡¨ç›˜', icon: 'ğŸ“Š', path: '#'},
        {id: 'users', name: 'ç”¨æˆ·ç®¡ç†', icon: 'ğŸ‘¥', path: '#users'},
        {id: 'products', name: 'äº§å“ç®¡ç†', icon: 'ğŸ“¦', path: '#products'},
        {id: 'orders', name: 'è®¢å•ç®¡ç†', icon: 'ğŸ“‹', path: '#orders'},
        {id: 'reports', name: 'æ•°æ®æŠ¥è¡¨', icon: 'ğŸ“ˆ', path: '#reports'},
        {id: 'settings', name: 'ç³»ç»Ÿè®¾ç½®', icon: 'âš™ï¸', path: '#settings'},
        {id: 'logs', name: 'æ“ä½œæ—¥å¿—', icon: 'ğŸ“', path: '#logs'}
    ];

    // åˆå§‹åŒ–é¡µé¢
    async function initPage() {
        // 1. è·å–å¹¶æ˜¾ç¤ºç”¨æˆ·ä¿¡æ¯
        await loadUserInfo();

        // 2. æ¸²æŸ“ä¾§è¾¹æ èœå•
        renderSidebarMenu();

        // 3. è®¾ç½®èœå•é¡¹ç‚¹å‡»äº‹ä»¶
        setupMenuClickHandlers();
    }

    // è·å–å½“å‰ç”¨æˆ·ä¿¡æ¯
    async function loadUserInfo() {
        if (!globalToken) {
            // å¦‚æœæ²¡æœ‰tokenï¼Œå¯ä»¥å°è¯•ä»localStorageè·å–æˆ–æç¤ºç”¨æˆ·é‡æ–°ç™»å½•
            // globalToken = localStorage.getItem('authToken');
            showMessage('æœªæ‰¾åˆ°è®¤è¯ä»¤ç‰Œï¼Œè¯·å…ˆç™»å½•ã€‚', 'error');
            return;
        }

        try {
            currentUserInfo = JSON.parse(localStorage.getItem('user'))
            if (currentUserInfo) {
                // æ›´æ–°é¡µé¢ä¸Šçš„ç”¨æˆ·ä¿¡æ¯æ˜¾ç¤º
                document.getElementById('usernameDisplay').textContent = currentUserInfo.name || 'æœªçŸ¥ç”¨æˆ·';
                document.getElementById('userRoleDisplay').textContent = currentUserInfo.role || 'æœªçŸ¥è§’è‰²';
                // å¯ä»¥æ ¹æ®ç”¨æˆ·ä¿¡æ¯è®¾ç½®å¤´åƒ
                document.getElementById('userAvatar').textContent = (currentUserInfo.name || 'U').charAt(0).toUpperCase();
            } else {
                showMessage('è·å–ç”¨æˆ·ä¿¡æ¯å¤±è´¥', 'error');
            }
        } catch (error) {
            console.error('è·å–ç”¨æˆ·ä¿¡æ¯å¤±è´¥:', error);
            let errorMessage = 'è·å–ç”¨æˆ·ä¿¡æ¯å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œæˆ–ç¨åé‡è¯•ã€‚';
            showMessage(errorMessage, 'error');
        }
    }

    // æ¸²æŸ“ä¾§è¾¹æ èœå•
    function renderSidebarMenu() {
        const sidebarMenuElement = document.getElementById('sidebarMenu');
        sidebarMenuElement.innerHTML = ''; // æ¸…ç©ºç°æœ‰å†…å®¹

        availableSystems.forEach(item => {
            const menuItem = document.createElement('div');
            menuItem.className = 'menu-item';
            menuItem.id = `menu-${item.id}`;
            menuItem.innerHTML = `
          <i>${item.icon}</i>
          <span>${item.name}</span>
        `;
            sidebarMenuElement.appendChild(menuItem);
        });

        // é»˜è®¤æ¿€æ´»ç¬¬ä¸€ä¸ªèœå•é¡¹
        if (availableSystems.length > 0) {
            const firstMenuItem = document.getElementById(`menu-${availableSystems[0].id}`);
            if (firstMenuItem) {
                firstMenuItem.classList.add('active');
            }
        }
    }

    // è®¾ç½®èœå•é¡¹ç‚¹å‡»äº‹ä»¶
    function setupMenuClickHandlers() {
        availableSystems.forEach(item => {
            const menuItem = document.getElementById(`menu-${item.id}`);
            if (menuItem) {
                menuItem.addEventListener('click', () => {
                    // ç§»é™¤å…¶ä»–èœå•é¡¹çš„æ¿€æ´»çŠ¶æ€
                    document.querySelectorAll('.menu-item').forEach(el => el.classList.remove('active'));
                    // æ·»åŠ å½“å‰ç‚¹å‡»é¡¹çš„æ¿€æ´»çŠ¶æ€
                    menuItem.classList.add('active');

                    // è¿™é‡Œå¯ä»¥åŠ è½½å¯¹åº”æ¨¡å—çš„å†…å®¹
                    loadModuleContent(item.id);
                });
            }
        });
    }

    // åŠ è½½æ¨¡å—å†…å®¹ (ç¤ºä¾‹)
    function loadModuleContent(moduleId) {
        const contentArea = document.getElementById('contentArea');

        // æ ¹æ®moduleIdæ˜¾ç¤ºä¸åŒçš„å†…å®¹
        switch (moduleId) {
            case 'dashboard':
                contentArea.innerHTML = `
            <h1>ä»ªè¡¨ç›˜</h1>
            <p>è¿™é‡Œæ˜¯ç³»ç»Ÿä»ªè¡¨ç›˜çš„æ¦‚è§ˆä¿¡æ¯ã€‚</p>
            <div class="dashboard-grid">
              <div class="dashboard-card">
                <h3>æ€»ç”¨æˆ·æ•°</h3>
                <p>1,234</p>
              </div>
              <div class="dashboard-card">
                <h3>ä»Šæ—¥æ´»è·ƒ</h3>
                <p>856</p>
              </div>
              <div class="dashboard-card">
                <h3>å¾…å¤„ç†è®¢å•</h3>
                <p>23</p>
              </div>
              <div class="dashboard-card">
                <h3>ç³»ç»Ÿå¥åº·</h3>
                <p>è‰¯å¥½</p>
              </div>
            </div>
          `;
                break;
            case 'users':
                contentArea.innerHTML = `
            <h1>ç”¨æˆ·ç®¡ç†</h1>
            <p>ç®¡ç†å¹³å°çš„æ‰€æœ‰ç”¨æˆ·ä¿¡æ¯ã€‚</p>
            <p>åŠŸèƒ½åŒ…æ‹¬ï¼šæ·»åŠ ç”¨æˆ·ã€ç¼–è¾‘ç”¨æˆ·ã€åˆ é™¤ç”¨æˆ·ã€æƒé™åˆ†é…ç­‰ã€‚</p>
          `;
                break;
            case 'products':
                contentArea.innerHTML = `<iframe src="product_manage/product.html" style="width:100%; height:100%; border:none;"></iframe>`;

                // fetch('product_manage/product.html')
                //     .then(res => {
                //         if (!res.ok) throw new Error('é¡µé¢åŠ è½½å¤±è´¥');
                //         return res.text();
                //     })
                //     .then(html => {
                //         contentArea.innerHTML = html;
                //     })
                //     .catch(err => {
                //         console.error('åŠ è½½ header å¤±è´¥:', err);
                //         contentArea.innerHTML = '<p>åŠ è½½å¤´éƒ¨å¤±è´¥</p>';
                //     });

                // contentArea.innerHTML = `
                //     <h1>äº§å“ç®¡ç†</h1>
                //     <p>ç®¡ç†å¹³å°çš„æ‰€æœ‰äº§å“ä¿¡æ¯ã€‚</p>
                //     <p>åŠŸèƒ½åŒ…æ‹¬ï¼šæ·»åŠ äº§å“ã€ç¼–è¾‘äº§å“ã€ä¸Šä¸‹æ¶ã€åº“å­˜ç®¡ç†ç­‰ã€‚</p>
                //   `;
                break;
            case 'orders':
                contentArea.innerHTML = `
            <h1>è®¢å•ç®¡ç†</h1>
            <p>ç®¡ç†å¹³å°çš„æ‰€æœ‰è®¢å•ä¿¡æ¯ã€‚</p>
            <p>åŠŸèƒ½åŒ…æ‹¬ï¼šæŸ¥çœ‹è®¢å•ã€å¤„ç†å‘è´§ã€è®¢å•çŠ¶æ€è·Ÿè¸ªç­‰ã€‚</p>
          `;
                break;
            case 'reports':
                contentArea.innerHTML = `
            <h1>æ•°æ®æŠ¥è¡¨</h1>
            <p>æŸ¥çœ‹å’Œåˆ†æä¸šåŠ¡æ•°æ®æŠ¥è¡¨ã€‚</p>
            <p>åŠŸèƒ½åŒ…æ‹¬ï¼šé”€å”®æŠ¥è¡¨ã€ç”¨æˆ·è¡Œä¸ºåˆ†æã€è´¢åŠ¡æŠ¥è¡¨ç­‰ã€‚</p>
          `;
                break;
            case 'settings':
                contentArea.innerHTML = `
            <h1>ç³»ç»Ÿè®¾ç½®</h1>
            <p>é…ç½®åå°ç®¡ç†ç³»ç»Ÿçš„å„é¡¹å‚æ•°ã€‚</p>
            <p>åŠŸèƒ½åŒ…æ‹¬ï¼šåŸºç¡€è®¾ç½®ã€å®‰å…¨è®¾ç½®ã€é‚®ä»¶é…ç½®ç­‰ã€‚</p>
          `;
                break;
            case 'logs':
                contentArea.innerHTML = `
            <h1>æ“ä½œæ—¥å¿—</h1>
            <p>æŸ¥çœ‹ç³»ç»Ÿç”¨æˆ·çš„æ“ä½œæ—¥å¿—è®°å½•ã€‚</p>
            <p>åŠŸèƒ½åŒ…æ‹¬ï¼šæ—¥å¿—æŸ¥è¯¢ã€æ—¥å¿—å¯¼å‡ºã€å¼‚å¸¸ç›‘æ§ç­‰ã€‚</p>
          `;
                break;
            default:
                contentArea.innerHTML = `<h1>${availableSystems.find(item => item.id === moduleId)?.name || 'æœªçŸ¥æ¨¡å—'}</h1><p>æ­¤æ¨¡å—çš„å†…å®¹æ­£åœ¨å¼€å‘ä¸­...</p>`;
        }
    }


    // æ˜¾ç¤ºæ¶ˆæ¯æç¤º
    function showMessage(text, type) {
        const mainContent = document.getElementById('mainContent');
        const messageDiv = document.createElement('div');
        messageDiv.className = `message ${type}`;
        messageDiv.textContent = text;

        // æ¸…é™¤æ—§çš„æ¶ˆæ¯
        const existingMessage = mainContent.querySelector('.message');
        if (existingMessage) {
            mainContent.removeChild(existingMessage);
        }

        // æ’å…¥æ–°æ¶ˆæ¯åˆ°å†…å®¹åŒºé¡¶éƒ¨
        mainContent.insertBefore(messageDiv, mainContent.firstChild);

        // 3ç§’åè‡ªåŠ¨ç§»é™¤
        setTimeout(() => {
            if (messageDiv.parentNode) {
                messageDiv.parentNode.removeChild(messageDiv);
            }
        }, 3000);
    }

    // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
    document.addEventListener('DOMContentLoaded', function () {
        // åœ¨å®é™…åº”ç”¨ä¸­ï¼Œè¿™é‡Œåº”è¯¥ä»ç™»å½•æˆåŠŸåè·å–åˆ° token
        // ä¸ºäº†æ¼”ç¤ºï¼Œæˆ‘ä»¬æš‚æ—¶ä¸è®¾ç½® globalTokenï¼Œæ‚¨éœ€è¦å…ˆç¡®ä¿æœ‰æœ‰æ•ˆçš„ token
        // globalToken = 'YOUR_VALID_TOKEN_HERE';
        initPage();
    });

    // ä¸ºäº†æ–¹ä¾¿æµ‹è¯•ï¼Œæš´éœ²ä¸€äº›å…¨å±€å‡½æ•°
    window.loadUserInfo = loadUserInfo;
    window.renderSidebarMenu = renderSidebarMenu;
    window.loadModuleContent = loadModuleContent;
    // window.globalToken = globalToken; // ä¸å»ºè®®ç›´æ¥æš´éœ²token
</script>

</body>
</html>



